title: Malware Download from Marketplace/C2 Host
id: 15f2c3d4-4e5f-4789-a1b2-3c4d5e6f7a8b
status: stable
description: Detects downloads of executable or script payloads from hosts/URLs indicative of dark web marketplaces, builder sites, or known C2 distribution points (.onion or marketplace keywords). Both file extension and dark-web/C2 indicator are required.
author: Ilyess Sellami
date: 2025-09-27
references:
  - https://attack.mitre.org/techniques/T1105/
tags:
  - attack.initial_access
  - attack.execution
logsource:
  category: proxy
  product: any
detection:
  selection_file:
    Url|re:
      - "(?i).*\\.(exe|msi|ps1|bat|sh|jar|bin|dll|scr)$"
  selection_darkweb_c2:
    Host|re:
      - "(?i).*\\b(onion|market|bazaar|vendor|c2|cmd|payload|drop)\\b.*"
    Url|re:
      - "(?i).*\\b(onion|market|bazaar|vendor|c2|payload|drop)\\b.*"
  condition: selection_file and selection_darkweb_c2
falsepositives:
  - legitimate software installers and vendor delivery URLs; use host allowlists and file-hash sandboxing
level: critical
confidence: high
detection_notes: >
  Recommend enriching host with TI (malicious marketplace/C2 lists), verifying file hashes via sandbox, and escalating when file is unsigned, packed, or has high entropy. For platforms without Url/Host fields, map `request_uri`/`destination`.
