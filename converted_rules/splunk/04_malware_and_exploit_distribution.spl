FileType="*PE*" FileEntropy>7.5
| regex FileName="(?i).*\\.(exe|dll|sys|scr)$"


| rex field=DestinationHost "(?<DestinationHostMatch>(?i).*\\.onion$)"
| eval DestinationHostCondition=if(isnotnull(DestinationHostMatch), "true", "false")
| rex field=DestinationHost "(?<DestinationHostMatch2>(?i).*\\b(c2|cmd|control|panel|onion|drop|beacon)\\b.*)"
| eval DestinationHostCondition2=if(isnotnull(DestinationHostMatch2), "true", "false")
| search DestinationHostCondition="true" OR DestinationHostCondition2="true"


| regex Url="(?i).*\\.(exe|msi|ps1|bat|sh|jar|bin|dll|scr)$"
| regex Host="(?i).*\\b(onion|market|bazaar|vendor|c2|cmd|payload|drop)\\b.*"
| regex Url="(?i).*\\b(onion|market|bazaar|vendor|c2|payload|drop)\\b.*"


| rex field=CommandLine "(?<CommandLineMatch>(?i)\\bgit\\s+clone\\b.*(exploit|exploit-kit|builder|crypter|stealer|ransom|c2|botnet))"
| eval CommandLineCondition=if(isnotnull(CommandLineMatch), "true", "false")
| rex field=CommandLine "(?<CommandLineMatch2>(?i)\\bsvn\\s+checkout\\b.*(exploit|builder|crypter))"
| eval CommandLineCondition2=if(isnotnull(CommandLineMatch2), "true", "false")
| rex field=CommandLine "(?<CommandLineMatch3>(?i)\\b(wget|curl)\\b.*(exploit|builder|crypter|payload|drop|market|onion))"
| eval CommandLineCondition3=if(isnotnull(CommandLineMatch3), "true", "false")
| search CommandLineCondition="true" OR CommandLineCondition2="true" OR CommandLineCondition3="true"


| rex field=Url "(?<UrlMatch>(?i).*/(exploit|ek|payload|swf|flash|exploit-kit|driveby|iframe|redirect)/.*)"
| eval UrlCondition=if(isnotnull(UrlMatch), "true", "false")
| rex field=Url "(?<UrlMatch2>(?i).*\\bexploit\\b.*(\\.js|\\.swf|\\.jar|\\.php).*)"
| eval UrlCondition2=if(isnotnull(UrlMatch2), "true", "false")
| rex field=Body "(?<BodyMatch>(?i)eval\\(|new\\s+ActiveXObject|document\\.createElement\\(|unescape\\(|atob\\(|fromCharCode\\()"
| eval BodyCondition=if(isnotnull(BodyMatch), "true", "false")
| search UrlCondition="true" OR UrlCondition2="true" OR BodyCondition="true"
